{% extends 'base.html' %}

{% block body_class %}page-state-list{% endblock %}

{% block schema %}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "ItemList",
    "name": "Holistic Veterinarians in {{ state.name }}",
    "description": "{{ page_description }}",
    "numberOfItems": {{ vets | length }},
    "itemListElement": [
        {% for vet in vets[:10] %}
        {
            "@type": "ListItem",
            "position": {{ loop.index }},
            "item": {
                "@type": "VeterinaryCare",
                "name": "{{ vet.practice_name }}",
                "address": {
                    "@type": "PostalAddress",
                    "addressLocality": "{{ vet.city }}",
                    "addressRegion": "{{ vet.state }}",
                    "postalCode": "{{ vet.zip_code }}"
                },
                "url": "{{ config.site_url }}/vet/{{ vet.slug }}/"
            }
        }{% if not loop.last %},{% endif %}
        {% endfor %}
    ]
}
</script>
{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <nav class="breadcrumb" aria-label="Breadcrumb">
            <ol class="breadcrumb__list">
                <li class="breadcrumb__item"><a href="/">Home</a></li>
                <li class="breadcrumb__item"><a href="/vets/">Find a Vet</a></li>
                <li class="breadcrumb__item" aria-current="page">{{ state.name }}</li>
            </ol>
        </nav>

        <h1 class="page-header__title">Holistic Veterinarians in {{ state.name }}</h1>
        <p class="page-header__subtitle">
            {{ vets | length }} holistic and integrative veterinary {{ vets | length | pluralize('practice', 'practices') }} in {{ state.name }}
        </p>
    </div>
</div>

<!-- Ad: Header -->
{% set slot_type = 'header' %}
{% include 'partials/adsense.html' %}

<div class="container">
    <div class="listing-layout">
        <!-- Sidebar -->
        <aside class="listing-sidebar">
            <!-- Cities in State -->
            {% if cities %}
            <div class="filter-section">
                <h3 class="filter-section__title">Cities in {{ state.name }}</h3>
                <ul class="filter-list filter-list--scrollable">
                    {% for city in cities %}
                    <li>
                        <a href="/vets/{{ state.slug }}/{{ city.slug }}/" class="filter-link">
                            {{ city.name }}
                            <span class="filter-count">{{ city.vet_count }}</span>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            <!-- Filter by Specialty -->
            <div class="filter-section">
                <h3 class="filter-section__title">Specialties Available</h3>
                <ul class="filter-list">
                    {% set state_specialties = [] %}
                    {% for vet in vets %}
                        {% for spec in vet.specialties %}
                            {% if spec not in state_specialties %}
                                {% set _ = state_specialties.append(spec) %}
                            {% endif %}
                        {% endfor %}
                    {% endfor %}
                    {% for specialty in specialties %}
                    {% if specialty.name in state_specialties %}
                    <li>
                        <a href="/specialty/{{ specialty.slug }}/" class="filter-link">
                            {{ specialty.name }}
                        </a>
                    </li>
                    {% endif %}
                    {% endfor %}
                </ul>
            </div>

            <!-- Other States -->
            <div class="filter-section">
                <h3 class="filter-section__title">Other States</h3>
                <ul class="filter-list filter-list--scrollable">
                    <li><a href="/vets/" class="filter-link">All States</a></li>
                </ul>
            </div>

            <!-- Sidebar Ad -->
            {% set slot_type = 'sidebar' %}
            {% include 'partials/adsense.html' %}
        </aside>

        <!-- Main Content -->
        <main class="listing-main">
            <div class="results-info">
                <p class="results-info__count">
                    {{ vets | length }} {{ vets | length | pluralize('result', 'results') }} in {{ state.name }}
                </p>
            </div>

            <!-- Vet Cards -->
            <div class="vet-list">
                {% for vet in vets %}
                    {% set show_description = true %}
                    {% include 'partials/vet_card.html' %}

                    {% if loop.index is divisibleby 6 and not loop.last %}
                        {% set slot_type = 'infeed' %}
                        {% include 'partials/adsense.html' %}
                    {% endif %}
                {% else %}
                <div class="empty-state">
                    <p>No veterinarians found in {{ state.name }}.</p>
                    <a href="/vets/" class="btn btn--primary">Browse All States</a>
                </div>
                {% endfor %}
            </div>
        </main>
    </div>
</div>

<!-- Ad: Footer -->
{% set slot_type = 'footer' %}
{% include 'partials/adsense.html' %}
{% endblock %}
